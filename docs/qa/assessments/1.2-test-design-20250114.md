# Test Design: Story 1.2

Date: 2025-01-14
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 6 (33%)
- Integration tests: 8 (44%)
- E2E tests: 4 (22%)
- Priority distribution: P0: 8, P1: 6, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Supabase configuré et connecté

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-001 | Unit        | P0       | Configuration Supabase valide | Validation de la configuration |
| 1.2-INT-001  | Integration | P0       | Connexion à Supabase fonctionne | Test de connectivité réelle |
| 1.2-E2E-001  | E2E         | P1       | Application se connecte au démarrage | Flux utilisateur critique |

### AC2: Tables User, Patient, Session, et Invoice créées

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-002 | Unit        | P0       | Schéma SQL valide | Validation de la structure |
| 1.2-INT-002  | Integration | P0       | Tables créées avec contraintes | Test de création de tables |
| 1.2-INT-003  | Integration | P0       | Relations entre tables fonctionnent | Test des clés étrangères |
| 1.2-E2E-002  | E2E         | P1       | Données persistées correctement | Flux de données complet |

### AC3: Politiques RLS implémentées

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-003 | Unit        | P0       | Politiques RLS syntaxiquement correctes | Validation de la syntaxe SQL |
| 1.2-INT-004  | Integration | P0       | Isolation des données par praticien | Test de sécurité critique |
| 1.2-INT-005  | Integration | P0       | Accès refusé aux données d'autres praticiens | Test de sécurité |
| 1.2-E2E-003  | E2E         | P0       | Utilisateur ne voit que ses données | Conformité RGPD critique |

### AC4: Relations entre entités définies

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-004 | Unit        | P1       | Contraintes de clés étrangères valides | Validation de l'intégrité |
| 1.2-INT-006  | Integration | P1       | Suppression en cascade fonctionne | Test des relations |
| 1.2-INT-007  | Integration | P1       | Requêtes avec jointures fonctionnent | Test des relations complexes |

### AC5: Contraintes de sécurité et validation

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-005 | Unit        | P1       | Contraintes d'unicité fonctionnent | Validation des contraintes |
| 1.2-INT-008  | Integration | P1       | Validation des données en base | Test de validation |
| 1.2-E2E-004  | E2E         | P2       | Erreurs de validation affichées | Expérience utilisateur |

### AC6: Index optimisés pour les performances

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.2-UNIT-006 | Unit        | P2       | Index créés correctement | Validation de la structure |
| 1.2-INT-009  | Integration | P2       | Requêtes utilisent les index | Test de performance |
| 1.2-INT-010  | Integration | P2       | Performances des requêtes acceptables | Test de performance |

## Risk Coverage

### SEC-001: Violation des politiques RLS
- **1.2-INT-004**: Isolation des données par praticien
- **1.2-INT-005**: Accès refusé aux données d'autres praticiens
- **1.2-E2E-003**: Utilisateur ne voit que ses données

### SEC-002: Exposition de données sensibles
- **1.2-INT-004**: Isolation des données par praticien
- **1.2-E2E-003**: Utilisateur ne voit que ses données

### PERF-001: Requêtes lentes sur grandes tables
- **1.2-INT-009**: Requêtes utilisent les index
- **1.2-INT-010**: Performances des requêtes acceptables

### DATA-001: Perte de données par suppression en cascade
- **1.2-INT-006**: Suppression en cascade fonctionne
- **1.2-INT-007**: Requêtes avec jointures fonctionnent

## Recommended Execution Order

1. **P0 Unit tests** (fail fast)
   - 1.2-UNIT-001: Configuration Supabase valide
   - 1.2-UNIT-002: Schéma SQL valide
   - 1.2-UNIT-003: Politiques RLS syntaxiquement correctes

2. **P0 Integration tests**
   - 1.2-INT-001: Connexion à Supabase fonctionne
   - 1.2-INT-002: Tables créées avec contraintes
   - 1.2-INT-003: Relations entre tables fonctionnent
   - 1.2-INT-004: Isolation des données par praticien
   - 1.2-INT-005: Accès refusé aux données d'autres praticiens

3. **P0 E2E tests**
   - 1.2-E2E-003: Utilisateur ne voit que ses données

4. **P1 tests**
   - 1.2-UNIT-004: Contraintes de clés étrangères valides
   - 1.2-INT-006: Suppression en cascade fonctionne
   - 1.2-INT-007: Requêtes avec jointures fonctionnent
   - 1.2-UNIT-005: Contraintes d'unicité fonctionnent
   - 1.2-INT-008: Validation des données en base
   - 1.2-E2E-001: Application se connecte au démarrage
   - 1.2-E2E-002: Données persistées correctement

5. **P2 tests** (as time permits)
   - 1.2-UNIT-006: Index créés correctement
   - 1.2-INT-009: Requêtes utilisent les index
   - 1.2-INT-010: Performances des requêtes acceptables
   - 1.2-E2E-004: Erreurs de validation affichées

## Test Implementation Guidelines

### Unit Tests (Vitest + React Testing Library)
- Tests de validation des configurations
- Tests de syntaxe SQL
- Tests de logique de contraintes

### Integration Tests (Vitest + Supabase Test Client)
- Tests de connexion à Supabase
- Tests de création de tables
- Tests des politiques RLS
- Tests des relations entre tables
- Tests de performance des requêtes

### E2E Tests (Playwright)
- Tests de flux utilisateur complet
- Tests de conformité RGPD
- Tests d'expérience utilisateur

## Coverage Gaps

Aucun gap de couverture identifié. Tous les critères d'acceptation sont couverts par au moins un test.

## Test Data Requirements

### Données de test nécessaires
- Utilisateurs de test avec différents rôles
- Patients de test pour différents praticiens
- Sessions de test avec données variées
- Factures de test avec différents statuts

### Environnement de test
- Base de données Supabase de test séparée
- Reset des données entre les tests
- Configuration d'environnement de test

## Maintenance Considerations

- Tests de politique RLS à maintenir lors des modifications de sécurité
- Tests de performance à exécuter régulièrement
- Tests de conformité RGPD à valider périodiquement
- Tests d'intégration à maintenir lors des changements de schéma
