# Test Design: Story 2.1 - Profil Patient/Sportif

Date: 2025-01-14
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 10 (56%)
- Integration tests: 6 (33%)
- E2E tests: 2 (11%)
- Priority distribution: P0: 6, P1: 8, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Un formulaire de création de profil est disponible

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-001 | Unit | P0 | Validation des champs obligatoires | Logique de validation pure |
| 2.1-UNIT-002 | Unit | P0 | Validation du format des données | Logique de validation pure |
| 2.1-INT-001 | Integration | P0 | Création complète de profil | Intégration formulaire/Supabase |
| 2.1-E2E-001 | E2E | P1 | Flux utilisateur de création | Parcours utilisateur complet |

### AC2: Les informations personnelles de base sont collectées

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-003 | Unit | P0 | Validation des informations personnelles | Validation des champs |
| 2.1-UNIT-004 | Unit | P1 | Formatage des données d'adresse | Utilitaires de formatage |
| 2.1-INT-002 | Integration | P1 | Sauvegarde des informations | Intégration avec base de données |

### AC3: La validation des données est en place

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-005 | Unit | P0 | Validation Zod des schémas | Validation côté client |
| 2.1-UNIT-006 | Unit | P1 | Messages d'erreur contextuels | Interface utilisateur |
| 2.1-INT-003 | Integration | P1 | Validation côté serveur | Intégration client/serveur |

### AC4: La modification des informations existantes est possible

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-007 | Unit | P1 | Pré-remplissage des champs | Logique de chargement |
| 2.1-INT-004 | Integration | P1 | Mise à jour des données | Intégration avec Supabase |
| 2.1-E2E-002 | E2E | P2 | Flux de modification | Parcours utilisateur |

### AC5: Le profil est sauvegardé automatiquement

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-008 | Unit | P0 | Logique de sauvegarde automatique | Fonctionnalité critique |
| 2.1-INT-005 | Integration | P1 | Sauvegarde avec debounce | Intégration timing/logique |

### AC6: Les données sensibles sont protégées

#### Scenarios

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 2.1-UNIT-009 | Unit | P0 | Chiffrement des données sensibles | Sécurité des données |
| 2.1-UNIT-010 | Unit | P0 | Validation des permissions RLS | Sécurité d'accès |
| 2.1-INT-006 | Integration | P1 | Test de conformité RGPD | Intégration sécurité |

## Risk Coverage

### Security Risks (SEC-001, SEC-002)

| Test ID | Risk Mitigated | Test Type |
|---------|----------------|-----------|
| 2.1-UNIT-009 | SEC-001, SEC-002 | Test de chiffrement et RLS |
| 2.1-INT-006 | SEC-001 | Test de conformité RGPD |

### Data Risks (DATA-001, DATA-002)

| Test ID | Risk Mitigated | Test Type |
|---------|----------------|-----------|
| 2.1-UNIT-008 | DATA-001 | Test de sauvegarde automatique |
| 2.1-INT-004 | DATA-002 | Test de gestion des conflits |

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 2.1-UNIT-001, 2.1-UNIT-002, 2.1-UNIT-003, 2.1-UNIT-005, 2.1-UNIT-008, 2.1-UNIT-009, 2.1-UNIT-010

2. P0 Integration tests
   - 2.1-INT-001

3. P0 E2E tests
   - 2.1-E2E-001

4. P1 tests in order
   - 2.1-UNIT-004, 2.1-UNIT-006, 2.1-UNIT-007, 2.1-INT-002, 2.1-INT-003, 2.1-INT-004, 2.1-INT-005, 2.1-INT-006

5. P2+ as time permits
   - 2.1-E2E-002

## Test Data Requirements

### Validation Test Data
- Données valides complètes
- Données invalides (formats incorrects)
- Données manquantes (champs obligatoires)
- Données avec caractères spéciaux

### Security Test Data
- Données sensibles (médicales)
- Données de test RGPD
- Données avec permissions différentes
- Données chiffrées/déchiffrées

### UI Test Data
- Profils complets
- Profils partiels
- Profils avec erreurs
- Données de test multilingues

## Test Environment Requirements

### Unit Tests
- Vitest avec mocks Supabase
- Données de test en mémoire
- Mocks des composants Radix UI

### Integration Tests
- Base de données de test Supabase
- Données réalistes
- Tests de sécurité

### E2E Tests
- Playwright avec données complètes
- Tests sur mobile et desktop
- Tests d'accessibilité

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
- [x] Security tests cover RGPD compliance
- [x] Data tests cover auto-save functionality
- [x] UI tests cover form interactions
