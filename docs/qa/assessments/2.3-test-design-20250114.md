# Test Design: Story 2.3 - Enregistrer des Exercices

Date: 2025-01-14
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 20
- Unit tests: 10 (50%)
- Integration tests: 8 (40%)
- E2E tests: 2 (10%)
- Priority distribution: P0: 8, P1: 8, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Une interface d'enregistrement d'exercices est disponible avec React Hook Form

#### Scenarios

| ID           | Level       | Priority | Test                               | Justification                   |
| ------------ | ----------- | -------- | ---------------------------------- | ------------------------------- |
| 2.3-UNIT-001 | Unit        | P0       | Validation des champs obligatoires | Logique de validation pure      |
| 2.3-UNIT-002 | Unit        | P0       | Validation des valeurs numériques  | Logique de validation pure      |
| 2.3-INT-001  | Integration | P0       | Création complète d'exercice       | Intégration formulaire/Supabase |
| 2.3-E2E-001  | E2E         | P1       | Flux utilisateur de création       | Parcours utilisateur complet    |

### AC2: Les informations de base sont collectées (nom, durée, intensité, notes, poids/séries)

#### Scenarios

| ID           | Level       | Priority | Test                           | Justification                    |
| ------------ | ----------- | -------- | ------------------------------ | -------------------------------- |
| 2.3-UNIT-003 | Unit        | P0       | Validation de l'intensité RPE  | Validation des plages            |
| 2.3-UNIT-004 | Unit        | P1       | Validation des poids et séries | Validation conditionnelle        |
| 2.3-INT-002  | Integration | P1       | Sauvegarde des informations    | Intégration avec base de données |

### AC3: La validation des données est en place avec Zod

#### Scenarios

| ID           | Level       | Priority | Test                          | Justification              |
| ------------ | ----------- | -------- | ----------------------------- | -------------------------- |
| 2.3-UNIT-005 | Unit        | P0       | Validation Zod des schémas    | Validation côté client     |
| 2.3-UNIT-006 | Unit        | P1       | Messages d'erreur contextuels | Interface utilisateur      |
| 2.3-INT-003  | Integration | P1       | Validation côté serveur       | Intégration client/serveur |

### AC4: L'ajout d'exercices multiples est possible avec drag & drop

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification           |
| ------------ | ----------- | -------- | ------------------------- | ----------------------- |
| 2.3-UNIT-007 | Unit        | P0       | Logique de drag & drop    | Fonctionnalité critique |
| 2.3-UNIT-008 | Unit        | P0       | Sauvegarde de l'ordre     | Fonctionnalité critique |
| 2.3-INT-004  | Integration | P1       | Drag & drop avec Supabase | Intégration complète    |
| 2.3-E2E-002  | E2E         | P2       | Flux de réorganisation    | Parcours utilisateur    |

### AC5: L'interface est optimisée pour mobile avec Radix UI

#### Scenarios

| ID           | Level       | Priority | Test                       | Justification          |
| ------------ | ----------- | -------- | -------------------------- | ---------------------- |
| 2.3-UNIT-009 | Unit        | P1       | Rendu des composants Radix | Composants UI          |
| 2.3-INT-005  | Integration | P2       | Interaction mobile         | Intégration UI/logique |

### AC6: Les données sont sauvegardées automatiquement via Supabase

#### Scenarios

| ID           | Level       | Priority | Test                              | Justification           |
| ------------ | ----------- | -------- | --------------------------------- | ----------------------- |
| 2.3-UNIT-010 | Unit        | P0       | Logique de sauvegarde automatique | Fonctionnalité critique |
| 2.3-INT-006  | Integration | P1       | Sauvegarde avec RLS               | Intégration sécurité    |

### AC7: La gestion des erreurs est robuste avec retry automatique

#### Scenarios

| ID          | Level       | Priority | Test              | Justification     |
| ----------- | ----------- | -------- | ----------------- | ----------------- |
| 2.3-INT-007 | Integration | P1       | Retry automatique | Gestion d'erreurs |
| 2.3-INT-008 | Integration | P2       | Fallback offline  | Gestion d'erreurs |

## Risk Coverage

### Data Risks (DATA-001, DATA-002)

| Test ID                    | Risk Mitigated     | Test Type                      |
| -------------------------- | ------------------ | ------------------------------ |
| 2.3-UNIT-007, 2.3-UNIT-008 | DATA-001, DATA-002 | Test de drag & drop et ordre   |
| 2.3-INT-004                | DATA-001           | Test de sauvegarde drag & drop |

### Performance Risks (PERF-001, PERF-002)

| Test ID     | Risk Mitigated | Test Type                        |
| ----------- | -------------- | -------------------------------- |
| 2.3-INT-006 | PERF-001       | Test de performance des requêtes |
| 2.3-INT-005 | PERF-002       | Test de rendu des listes         |

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 2.3-UNIT-001, 2.3-UNIT-002, 2.3-UNIT-003, 2.3-UNIT-005, 2.3-UNIT-007, 2.3-UNIT-008, 2.3-UNIT-010

2. P0 Integration tests
   - 2.3-INT-001

3. P0 E2E tests
   - 2.3-E2E-001

4. P1 tests in order
   - 2.3-UNIT-004, 2.3-UNIT-006, 2.3-UNIT-009, 2.3-INT-002, 2.3-INT-003, 2.3-INT-004, 2.3-INT-006, 2.3-INT-007

5. P2+ as time permits
   - 2.3-INT-005, 2.3-INT-008, 2.3-E2E-002

## Test Data Requirements

### Validation Test Data

- Exercices valides complets
- Exercices invalides (valeurs hors plage)
- Exercices avec intensité extrême
- Exercices avec poids/séries invalides

### Drag & Drop Test Data

- 10+ exercices par session
- Exercices de différents types
- Exercices avec ordre complexe
- Données avec conflits potentiels

### Performance Test Data

- 50+ exercices par session
- Sessions avec exercices multiples
- Exercices avec données volumineuses
- Données avec calculs intensifs

## Test Environment Requirements

### Unit Tests

- Vitest avec mocks Supabase
- Données de test en mémoire
- Mocks des composants @dnd-kit

### Integration Tests

- Base de données de test Supabase
- Données réalistes
- Tests de performance

### E2E Tests

- Playwright avec données complètes
- Tests sur mobile et desktop
- Tests de drag & drop

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
- [x] Drag & drop tests cover critical functionality
- [x] Performance tests cover large datasets
- [x] UI tests cover mobile interactions
