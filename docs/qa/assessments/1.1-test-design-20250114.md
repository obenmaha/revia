# Test Design: Story 1.1 - Configuration du Projet et Infrastructure

**Date:** 2025-01-14  
**Designer:** Quinn (Test Architect)  
**Story:** Configuration du Projet et Infrastructure  
**Epic:** 1 - Infrastructure de Base

## Test Strategy Overview

- **Total test scenarios:** 18
- **Unit tests:** 12 (67%)
- **Integration tests:** 4 (22%)
- **E2E tests:** 2 (11%)
- **Priority distribution:** P0: 8, P1: 6, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Le projet utilise React 19 avec TypeScript et Vite

#### Scenarios

| ID           | Level       | Priority | Test                                 | Justification                     |
| ------------ | ----------- | -------- | ------------------------------------ | --------------------------------- |
| 1.1-UNIT-001 | Unit        | P0       | Vérifier la version React 19         | Validation de la version critique |
| 1.1-UNIT-002 | Unit        | P0       | Vérifier la configuration TypeScript | Configuration stricte requise     |
| 1.1-UNIT-003 | Unit        | P0       | Vérifier la version Vite 7+          | Outil de build critique           |
| 1.1-INT-001  | Integration | P1       | Test de build complet                | Validation de l'intégration       |

### AC2: La configuration ESLint et Prettier est en place

#### Scenarios

| ID           | Level       | Priority | Test                               | Justification                |
| ------------ | ----------- | -------- | ---------------------------------- | ---------------------------- |
| 1.1-UNIT-004 | Unit        | P0       | Vérifier la configuration ESLint   | Qualité de code critique     |
| 1.1-UNIT-005 | Unit        | P0       | Vérifier la configuration Prettier | Formatage automatique        |
| 1.1-UNIT-006 | Unit        | P1       | Test de linting sur code existant  | Validation du fonctionnement |
| 1.1-INT-002  | Integration | P1       | Test d'intégration ESLint/Prettier | Workflow de développement    |

### AC3: Les tests unitaires sont configurés avec Vitest

#### Scenarios

| ID           | Level       | Priority | Test                             | Justification              |
| ------------ | ----------- | -------- | -------------------------------- | -------------------------- |
| 1.1-UNIT-007 | Unit        | P0       | Vérifier la configuration Vitest | Framework de test critique |
| 1.1-UNIT-008 | Unit        | P0       | Vérifier React Testing Library   | Tests de composants        |
| 1.1-UNIT-009 | Unit        | P1       | Exécuter les tests existants     | Validation du setup        |
| 1.1-INT-003  | Integration | P1       | Test de couverture de code       | Métriques de qualité       |

### AC4: Le projet est configuré pour le déploiement sur Vercel

#### Scenarios

| ID           | Level | Priority | Test                                   | Justification               |
| ------------ | ----- | -------- | -------------------------------------- | --------------------------- |
| 1.1-UNIT-010 | Unit  | P0       | Vérifier la configuration Vercel       | Déploiement critique        |
| 1.1-UNIT-011 | Unit  | P1       | Vérifier les variables d'environnement | Configuration de production |
| 1.1-E2E-001  | E2E   | P1       | Test de build de production            | Validation du déploiement   |

### AC5: La structure de dossiers suit les bonnes pratiques React

#### Scenarios

| ID           | Level       | Priority | Test                               | Justification                |
| ------------ | ----------- | -------- | ---------------------------------- | ---------------------------- |
| 1.1-UNIT-012 | Unit        | P2       | Vérifier la structure des dossiers | Organisation du code         |
| 1.1-INT-004  | Integration | P2       | Test d'imports entre modules       | Validation de l'architecture |

### AC6: Les variables d'environnement sont correctement configurées

#### Scenarios

| ID           | Level | Priority | Test                                 | Justification             |
| ------------ | ----- | -------- | ------------------------------------ | ------------------------- |
| 1.1-UNIT-013 | Unit  | P0       | Vérifier la validation des variables | Sécurité et configuration |
| 1.1-UNIT-014 | Unit  | P1       | Test des variables manquantes        | Gestion d'erreurs         |
| 1.1-E2E-002  | E2E   | P2       | Test de démarrage avec variables     | Validation complète       |

## Risk Coverage

### Risques identifiés et mitigation

| Risk ID  | Description                          | Mitigated by Tests                       |
| -------- | ------------------------------------ | ---------------------------------------- |
| RISK-001 | Configuration incorrecte             | 1.1-UNIT-001 à 1.1-UNIT-014              |
| RISK-002 | Build de production échoué           | 1.1-E2E-001, 1.1-INT-001                 |
| RISK-003 | Variables d'environnement manquantes | 1.1-UNIT-013, 1.1-UNIT-014               |
| RISK-004 | Qualité de code dégradée             | 1.1-UNIT-004, 1.1-UNIT-005, 1.1-UNIT-006 |

## Detailed Test Scenarios

### Unit Tests (P0 - Critical)

#### 1.1-UNIT-001: Vérifier la version React 19

```typescript
describe('React Version', () => {
  it('should use React 19.x', () => {
    expect(React.version).toMatch(/^19\./);
  });
});
```

#### 1.1-UNIT-002: Vérifier la configuration TypeScript

```typescript
describe('TypeScript Configuration', () => {
  it('should have strict mode enabled', () => {
    // Vérifier tsconfig.json
    const tsConfig = require('../tsconfig.json');
    expect(tsConfig.compilerOptions.strict).toBe(true);
  });
});
```

#### 1.1-UNIT-003: Vérifier la version Vite 7+

```typescript
describe('Vite Version', () => {
  it('should use Vite 7+', () => {
    const packageJson = require('../package.json');
    const viteVersion = packageJson.devDependencies.vite;
    expect(parseInt(viteVersion.split('.')[0])).toBeGreaterThanOrEqual(7);
  });
});
```

#### 1.1-UNIT-004: Vérifier la configuration ESLint

```typescript
describe('ESLint Configuration', () => {
  it('should have ESLint config file', () => {
    expect(fs.existsSync('eslint.config.js')).toBe(true);
  });

  it('should have TypeScript rules enabled', () => {
    const eslintConfig = require('../eslint.config.js');
    // Vérifier la présence de règles TypeScript
  });
});
```

#### 1.1-UNIT-005: Vérifier la configuration Prettier

```typescript
describe('Prettier Configuration', () => {
  it('should have Prettier config file', () => {
    expect(fs.existsSync('.prettierrc')).toBe(true);
  });
});
```

#### 1.1-UNIT-007: Vérifier la configuration Vitest

```typescript
describe('Vitest Configuration', () => {
  it('should have Vitest config file', () => {
    expect(fs.existsSync('vitest.config.ts')).toBe(true);
  });
});
```

#### 1.1-UNIT-008: Vérifier React Testing Library

```typescript
describe('React Testing Library', () => {
  it('should have RTL installed', () => {
    const packageJson = require('../package.json');
    expect(packageJson.devDependencies['@testing-library/react']).toBeDefined();
  });
});
```

#### 1.1-UNIT-010: Vérifier la configuration Vercel

```typescript
describe('Vercel Configuration', () => {
  it('should have vercel.json file', () => {
    expect(fs.existsSync('vercel.json')).toBe(true);
  });
});
```

#### 1.1-UNIT-013: Vérifier la validation des variables

```typescript
describe('Environment Variables Validation', () => {
  it('should validate required environment variables', () => {
    // Tester la fonction de validation des variables
    expect(() => validateEnv()).not.toThrow();
  });
});
```

### Unit Tests (P1 - High)

#### 1.1-UNIT-006: Test de linting sur code existant

```typescript
describe('Code Linting', () => {
  it('should pass ESLint on all source files', async () => {
    const result = await exec('npm run lint');
    expect(result.exitCode).toBe(0);
  });
});
```

#### 1.1-UNIT-009: Exécuter les tests existants

```typescript
describe('Existing Tests', () => {
  it('should run all existing tests successfully', async () => {
    const result = await exec('npm run test:run');
    expect(result.exitCode).toBe(0);
  });
});
```

#### 1.1-UNIT-011: Vérifier les variables d'environnement

```typescript
describe('Environment Variables', () => {
  it('should have all required variables defined', () => {
    const requiredVars = ['VITE_SUPABASE_URL', 'VITE_SUPABASE_ANON_KEY'];
    requiredVars.forEach(varName => {
      expect(process.env[varName]).toBeDefined();
    });
  });
});
```

#### 1.1-UNIT-014: Test des variables manquantes

```typescript
describe('Missing Environment Variables', () => {
  it('should throw error for missing required variables', () => {
    const originalEnv = process.env;
    process.env = {};
    expect(() => validateEnv()).toThrow();
    process.env = originalEnv;
  });
});
```

### Unit Tests (P2 - Medium)

#### 1.1-UNIT-012: Vérifier la structure des dossiers

```typescript
describe('Project Structure', () => {
  it('should have required directories', () => {
    const requiredDirs = [
      'src/components',
      'src/pages',
      'src/hooks',
      'src/services',
      'src/types',
      'src/utils',
    ];
    requiredDirs.forEach(dir => {
      expect(fs.existsSync(dir)).toBe(true);
    });
  });
});
```

### Integration Tests

#### 1.1-INT-001: Test de build complet

```typescript
describe('Build Integration', () => {
  it('should build successfully', async () => {
    const result = await exec('npm run build');
    expect(result.exitCode).toBe(0);
    expect(fs.existsSync('dist')).toBe(true);
  });
});
```

#### 1.1-INT-002: Test d'intégration ESLint/Prettier

```typescript
describe('Linting Integration', () => {
  it('should format code with Prettier', async () => {
    const result = await exec('npm run format');
    expect(result.exitCode).toBe(0);
  });
});
```

#### 1.1-INT-003: Test de couverture de code

```typescript
describe('Code Coverage', () => {
  it('should have minimum code coverage', async () => {
    const result = await exec('npm run test:coverage');
    expect(result.exitCode).toBe(0);
    // Vérifier que la couverture est > 80%
  });
});
```

#### 1.1-INT-004: Test d'imports entre modules

```typescript
describe('Module Imports', () => {
  it('should resolve all imports correctly', () => {
    // Tester que tous les imports fonctionnent
    expect(() => require('../src/main.tsx')).not.toThrow();
  });
});
```

### End-to-End Tests

#### 1.1-E2E-001: Test de build de production

```typescript
describe('Production Build E2E', () => {
  it('should create production build with correct assets', async () => {
    await exec('npm run build');

    // Vérifier les fichiers de sortie
    expect(fs.existsSync('dist/index.html')).toBe(true);
    expect(fs.existsSync('dist/assets')).toBe(true);

    // Vérifier la taille du bundle
    const stats = fs.statSync('dist/assets/index-*.js');
    expect(stats.size).toBeLessThan(200000); // < 200KB
  });
});
```

#### 1.1-E2E-002: Test de démarrage avec variables

```typescript
describe('Application Startup E2E', () => {
  it('should start application with environment variables', async () => {
    const server = await startTestServer();
    const response = await fetch('http://localhost:3000');
    expect(response.status).toBe(200);
    await server.close();
  });
});
```

## Recommended Execution Order

1. **P0 Unit tests** (fail fast)
   - 1.1-UNIT-001 à 1.1-UNIT-005, 1.1-UNIT-007, 1.1-UNIT-008, 1.1-UNIT-010, 1.1-UNIT-013
2. **P0 Integration tests**
   - 1.1-INT-001
3. **P1 Unit tests**
   - 1.1-UNIT-006, 1.1-UNIT-009, 1.1-UNIT-011, 1.1-UNIT-014
4. **P1 Integration tests**
   - 1.1-INT-002, 1.1-INT-003
5. **P1 E2E tests**
   - 1.1-E2E-001
6. **P2 tests** (as time permits)
   - 1.1-UNIT-012, 1.1-INT-004, 1.1-E2E-002

## Test Environment Requirements

### Prerequisites

- Node.js 20 LTS
- npm 10+
- Git

### Test Data

- Fichiers de configuration par défaut
- Variables d'environnement de test
- Code source existant pour les tests de linting

### Test Execution Commands

```bash
# Unit tests
npm run test

# Linting
npm run lint

# Formatting
npm run format

# Build test
npm run build

# Coverage
npm run test:coverage
```

## Quality Gates

### Pass Criteria

- ✅ Tous les tests P0 passent (100%)
- ✅ Au moins 80% des tests P1 passent
- ✅ Build de production réussi
- ✅ Aucune erreur de linting critique

### Fail Criteria

- ❌ Échec de tests P0
- ❌ Build de production échoué
- ❌ Erreurs de linting bloquantes
- ❌ Variables d'environnement manquantes

## Maintenance Notes

- Les tests de configuration doivent être mis à jour lors des changements de versions
- Les tests de structure doivent être adaptés si l'architecture change
- Les tests de variables d'environnement doivent être synchronisés avec les changements de configuration
