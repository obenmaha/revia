# Story 1.7: Mode Guest (sans export)

## Status

Ready for Development

## Story

**En tant qu'** utilisateur sportif,
**Je veux** essayer l'application sans créer de compte,
**Afin de** tester les fonctionnalités avant de m'engager.

## Acceptance Criteria

1. Mode Guest avec données locales temporaires (localStorage chiffré, expiration 30 jours)
2. Onboarding simplifié en 1 clic sans authentification
3. Bannière de conversion "Sauvegarder mon progrès" avec appel à l'action clair

## Tasks / Subtasks

- [ ] Implémenter le mode Guest avec stockage local (AC: 1)
  - [ ] Créer le service de gestion Guest (`guestService.ts`)
  - [ ] Implémenter le chiffrement client-side avec crypto-js
  - [ ] Créer le hook `useGuest.ts` pour la gestion d'état Guest
  - [ ] Implémenter le stockage localStorage avec expiration 30 jours
  - [ ] Créer le hook `useLocalStorage.ts` pour la persistence
  - [ ] Gérer la synchronisation des données entre localStorage et état
  - [ ] Implémenter la détection et nettoyage des données expirées
  - [ ] Ajouter les types TypeScript pour les données Guest
- [ ] Développer l'onboarding simplifié (AC: 2)
  - [ ] Créer le composant `GuestOnboarding.tsx`
  - [ ] Implémenter le flux d'entrée en 1 clic
  - [ ] Créer la page d'accueil Guest (`guest/GuestHomePage.tsx`)
  - [ ] Adapter les composants existants pour le mode Guest
  - [ ] Implémenter la détection automatique du mode (Guest vs Authenticated)
  - [ ] Créer le routing spécifique pour le mode Guest
  - [ ] Ajouter les guards de navigation pour Guest
- [ ] Créer la bannière de conversion (AC: 3)
  - [ ] Développer le composant `GuestBanner.tsx`
  - [ ] Implémenter la logique d'affichage contextuel
  - [ ] Créer les CTA de conversion (créer compte/se connecter)
  - [ ] Ajouter le compteur de sessions en mode Guest
  - [ ] Implémenter la persistance de l'état de la bannière
  - [ ] Gérer l'affichage responsive de la bannière
  - [ ] Ajouter les animations et transitions
- [ ] Implémenter la migration Guest vers compte (AC: 4)
  - [ ] Créer le service de migration (`guestMigrationService.ts`)
  - [ ] Développer le hook `useGuestMigration.ts`
  - [ ] Créer le modal `GuestMigrationModal.tsx`
  - [ ] Implémenter le flux de création de compte depuis Guest
  - [ ] Gérer la migration des données vers Supabase
  - [ ] Implémenter le consentement RGPD explicite
  - [ ] Vérifier l'intégrité des données migrées
  - [ ] Nettoyer les données locales après migration réussie
  - [ ] Gérer les erreurs de migration avec rollback
- [ ] Implémenter la conformité RGPD (AC: 1, 4)
  - [ ] Créer le service RGPD (`gdprService.ts`)
  - [ ] Développer le composant `DataDeletionModal.tsx`
  - [ ] Implémenter le consentement explicite pour la migration
  - [ ] Ajouter les mentions légales aux exports
  - [ ] Créer la page de politique de confidentialité Guest
  - [ ] Implémenter la suppression complète des données
  - [ ] Gérer l'expiration automatique après 30 jours
  - [ ] Ajouter les logs de consentement et suppression
- [ ] Développer le service de chiffrement (AC: 1)
  - [ ] Créer le service `encryptionService.ts`
  - [ ] Implémenter le chiffrement AES avec crypto-js
  - [ ] Gérer la génération de clés de chiffrement
  - [ ] Implémenter le déchiffrement sécurisé
  - [ ] Ajouter la validation des données chiffrées
  - [ ] Gérer les erreurs de chiffrement/déchiffrement
- [ ] Créer les tests pour le mode Guest (AC: 1, 2, 3, 4)
  - [ ] Tests unitaires pour `guestService.ts`
  - [ ] Tests unitaires pour `encryptionService.ts`
  - [ ] Tests unitaires pour `guestMigrationService.ts`
  - [ ] Tests unitaires pour `gdprService.ts`
  - [ ] Tests d'intégration pour le flux Guest complet
  - [ ] Tests d'intégration pour la migration de données
  - [ ] Tests E2E pour l'onboarding Guest
  - [ ] Tests E2E pour la conversion Guest vers compte
  - [ ] Tests E2E pour l'export en mode Guest
  - [ ] Tests de sécurité pour le chiffrement
  - [ ] Tests de conformité RGPD

## Dev Notes

### Architecture Context

[Source: docs/architecture/03-data-models.md#guestdata]

**Stack Frontend :**

- React 19 + TypeScript + Vite
- TanStack Query v5 pour la gestion d'état serveur
- Radix UI + Tailwind CSS pour l'interface
- Zustand pour l'état global (mode Guest/Authenticated)
- crypto-js pour le chiffrement client-side
- React Hook Form + Zod pour les formulaires
- LocalStorage API pour la persistence Guest

**Modèles de données :**

```typescript
// GuestSession - Données temporaires Guest
interface GuestSession {
  guestId: string; // UUID généré côté client
  sessions: SportSession[]; // Sessions locales
  exercises: SportExercise[]; // Exercices locaux
  stats: GuestStats; // Statistiques calculées localement
  createdAt: Date;
  expiresAt: Date; // createdAt + 30 days
  encrypted: boolean;
  version: string; // Version du schéma pour migrations
}

// GuestStats - Statistiques locales
interface GuestStats {
  totalSessions: number;
  weeklyFrequency: number;
  currentStreak: number;
  lastSessionDate: Date;
}

// GuestMigration - Données de migration
interface GuestMigration {
  guestId: string;
  userId: string; // Après création compte
  migratedAt: Date;
  sessionCount: number;
  exerciseCount: number;
  consent: GuestMigrationConsent;
  status: 'pending' | 'in_progress' | 'completed' | 'failed';
  error?: string;
}

// GuestMigrationConsent - Consentement RGPD
interface GuestMigrationConsent {
  dataRetention: boolean; // Consentement pour la rétention des données
  dataProcessing: boolean; // Consentement pour le traitement
  termsAccepted: boolean; // Acceptation des CGU
  privacyPolicyAccepted: boolean; // Acceptation politique de confidentialité
  timestamp: Date;
  ipAddress?: string; // Optionnel pour traçabilité
}

// ExportRequest - Demande d'export (Guest ou Authenticated)
interface ExportRequest {
  userId?: string; // Pour utilisateurs authentifiés
  guestId?: string; // Pour mode Guest
  format: 'csv' | 'pdf';
  startDate: Date;
  endDate: Date;
  includePersonalData: boolean;
  gdprConsent: boolean;
  includeMetadata: boolean;
  includeLegalNotice: boolean;
}

// GDPRRequest - Demande RGPD
interface GDPRRequest {
  type: 'export' | 'delete' | 'access';
  userId?: string;
  guestId?: string;
  consent: boolean;
  timestamp: Date;
  processed: boolean;
  processedAt?: Date;
}

// EncryptedData - Données chiffrées
interface EncryptedData {
  data: string; // Données chiffrées en base64
  iv: string; // Vecteur d'initialisation
  salt: string; // Salt pour la dérivation de clé
  algorithm: 'AES-256-GCM';
  version: string; // Version du chiffrement
}

// LocalStorageKeys - Clés localStorage
enum LocalStorageKeys {
  GUEST_SESSION = 'revia_guest_session',
  GUEST_ID = 'revia_guest_id',
  GUEST_ENCRYPTION_KEY = 'revia_guest_key',
  GUEST_CREATED_AT = 'revia_guest_created_at',
  GUEST_EXPIRES_AT = 'revia_guest_expires_at',
  BANNER_DISMISSED = 'revia_banner_dismissed',
}
```

**Structure de composants :**

```
src/
├── components/
│   └── features/
│       ├── guest/
│       │   ├── GuestOnboarding.tsx           # Onboarding 1-click
│       │   ├── GuestBanner.tsx               # Bannière conversion
│       │   ├── GuestMigrationModal.tsx       # Modal de migration
│       │   ├── GuestMigrationProgress.tsx    # Progression migration
│       │   └── GuestSessionPreview.tsx       # Aperçu des sessions Guest
│       ├── export/
│       │   ├── ExportSettings.tsx            # Configuration export
│       │   └── DataDeletionModal.tsx         # Suppression RGPD
│       └── privacy/
│           ├── ConsentForm.tsx               # Formulaire de consentement
│           ├── PrivacyNotice.tsx             # Mentions RGPD
│           └── DataRetentionInfo.tsx         # Informations rétention
├── pages/
│   └── guest/
│       ├── GuestHomePage.tsx                 # Page d'accueil Guest
│       ├── GuestOnboardingPage.tsx           # Page onboarding
│       └── GuestConversionPage.tsx           # Page de conversion
├── services/
│   ├── guestService.ts                       # Gestion Guest
│   ├── guestMigrationService.ts              # Migration données
│   ├── encryptionService.ts                  # Chiffrement client
│   ├── gdprService.ts                        # Conformité RGPD
│   └── sportExportService.ts                 # Export (déjà existant)
├── hooks/
│   ├── useGuest.ts                           # Hook gestion Guest
│   ├── useGuestMigration.ts                  # Hook migration
│   ├── useLocalStorage.ts                    # Hook localStorage
│   └── useGuestExport.ts                     # Hook export Guest
└── utils/
    ├── encryption.ts                         # Utilitaires chiffrement
    ├── localStorage.ts                       # Utilitaires localStorage
    └── gdprCompliance.ts                     # Utilitaires RGPD (déjà existant)
```

**Services principaux :**

```typescript
// guestService.ts - Gestion des sessions Guest
class GuestService {
  // Création d'une nouvelle session Guest
  static createGuestSession(): GuestSession;

  // Récupération de la session Guest courante
  static getGuestSession(): GuestSession | null;

  // Sauvegarde d'une session Guest (avec chiffrement)
  static saveGuestSession(session: GuestSession): void;

  // Ajout d'une session sportive en mode Guest
  static addSession(session: SportSession): void;

  // Ajout d'un exercice en mode Guest
  static addExercise(sessionId: string, exercise: SportExercise): void;

  // Vérification de l'expiration
  static isSessionExpired(): boolean;

  // Nettoyage des données expirées
  static cleanupExpiredData(): void;

  // Calcul des statistiques Guest
  static calculateStats(): GuestStats;
}

// encryptionService.ts - Chiffrement client-side
class EncryptionService {
  // Chiffrement des données
  static encrypt(data: any): EncryptedData;

  // Déchiffrement des données
  static decrypt(encrypted: EncryptedData): any;

  // Génération d'une clé de chiffrement
  static generateKey(): string;

  // Validation des données chiffrées
  static validateEncrypted(encrypted: EncryptedData): boolean;
}

// guestMigrationService.ts - Migration Guest vers compte
class GuestMigrationService {
  // Préparation de la migration
  static prepareMigration(guestId: string): GuestMigration;

  // Migration des données vers Supabase
  static async migrateToAccount(
    guestSession: GuestSession,
    userId: string,
    consent: GuestMigrationConsent
  ): Promise<{ success: boolean; error?: string }>;

  // Vérification de l'intégrité des données
  static validateMigration(guestId: string, userId: string): Promise<boolean>;

  // Rollback en cas d'erreur
  static rollbackMigration(migrationId: string): Promise<void>;

  // Nettoyage après migration
  static cleanupAfterMigration(guestId: string): void;
}

// gdprService.ts - Conformité RGPD
class GDPRService {
  // Enregistrement du consentement
  static recordConsent(consent: GuestMigrationConsent): void;

  // Vérification du consentement
  static checkConsent(type: string): boolean;

  // Suppression complète des données
  static async deleteAllData(userId?: string, guestId?: string): Promise<void>;

  // Export des données RGPD
  static async exportUserData(
    userId?: string,
    guestId?: string
  ): Promise<ExportRequest>;

  // Génération des mentions légales
  static generateLegalNotice(): string;

  // Vérification de l'expiration automatique
  static checkAutoExpiration(): void;
}
```

**Hooks spécialisés :**

```typescript
// useGuest.ts - Gestion du mode Guest
function useGuest() {
  return {
    isGuest: boolean;
    guestSession: GuestSession | null;
    guestStats: GuestStats;
    isExpired: boolean;
    daysRemaining: number;
    createGuestSession: () => void;
    addSession: (session: SportSession) => void;
    addExercise: (sessionId: string, exercise: SportExercise) => void;
    clearGuestData: () => void;
  };
}

// useGuestMigration.ts - Migration Guest
function useGuestMigration() {
  return {
    isMigrating: boolean;
    migrationProgress: number;
    error: string | null;
    startMigration: (userId: string, consent: GuestMigrationConsent) => Promise<void>;
    cancelMigration: () => void;
    retryMigration: () => Promise<void>;
  };
}

// useLocalStorage.ts - Persistence localStorage
function useLocalStorage<T>(key: string, initialValue: T) {
  return {
    value: T;
    setValue: (value: T) => void;
    removeValue: () => void;
    isEncrypted: boolean;
  };
}

// useGuestExport.ts - Export en mode Guest
function useGuestExport() {
  return {
    exportGuestData: (format: 'csv' | 'pdf') => Promise<void>;
    isExporting: boolean;
    error: string | null;
  };
}
```

**Intégration Supabase pour la migration :**

```typescript
// Migration des sessions Guest vers Supabase
const migrateGuestSessions = async (
  guestSession: GuestSession,
  userId: string
) => {
  // 1. Créer le profil sport utilisateur
  const { data: sportUser } = await supabase
    .from('sport_users')
    .insert({
      id: userId,
      display_name: 'Utilisateur',
      guest_data_migrated: true,
      data_retention_consent: true,
    })
    .select()
    .single();

  // 2. Migrer les sessions
  const sessionsToInsert = guestSession.sessions.map(session => ({
    ...session,
    user_id: userId,
    // Conserver les IDs pour la relation avec les exercices
  }));

  const { data: migratedSessions } = await supabase
    .from('sport_sessions')
    .insert(sessionsToInsert)
    .select();

  // 3. Migrer les exercices
  const exercisesToInsert = guestSession.exercises.map(exercise => ({
    ...exercise,
    // Les session_id sont préservés
  }));

  await supabase
    .from('sport_exercises')
    .insert(exercisesToInsert);

  return { success: true, sessionCount: migratedSessions?.length || 0 };
};
```

**Flux de chiffrement localStorage :**

```typescript
// Sauvegarde chiffrée
const saveEncrypted = (key: string, data: any) => {
  // 1. Générer ou récupérer la clé de chiffrement
  const encryptionKey = EncryptionService.generateKey();

  // 2. Chiffrer les données
  const encrypted = EncryptionService.encrypt(data);

  // 3. Sauvegarder dans localStorage
  localStorage.setItem(key, JSON.stringify(encrypted));
  localStorage.setItem(`${key}_key`, encryptionKey);
};

// Récupération déchiffrée
const loadEncrypted = (key: string) => {
  // 1. Récupérer les données chiffrées
  const encryptedStr = localStorage.getItem(key);
  if (!encryptedStr) return null;

  const encrypted = JSON.parse(encryptedStr);

  // 2. Récupérer la clé de chiffrement
  const encryptionKey = localStorage.getItem(`${key}_key`);
  if (!encryptionKey) return null;

  // 3. Déchiffrer les données
  return EncryptionService.decrypt(encrypted);
};
```

### Testing Standards

[Source: docs/architecture/04-component-architecture.md#testing-requirements]

**Tests unitaires (Vitest) :**

- Service Guest (création, sauvegarde, récupération)
- Service de chiffrement (encrypt/decrypt, validation)
- Service de migration (préparation, validation, rollback)
- Service RGPD (consentement, suppression, export)
- Hooks personnalisés (useGuest, useGuestMigration, useLocalStorage)
- Utilitaires de chiffrement et localStorage
- Calculs de statistiques Guest

**Tests d'intégration :**

- Flux complet Guest (onboarding → sessions → export)
- Migration Guest vers compte Supabase
- Chiffrement/déchiffrement bout-en-bout
- Persistence localStorage avec expiration
- Export en mode Guest (CSV/PDF)
- Suppression complète des données

**Tests E2E (Playwright) :**

- Parcours onboarding Guest en 1 clic
- Création et validation de sessions en mode Guest
- Bannière de conversion et CTA
- Flux de migration complet (Guest → Compte)
- Export des données Guest
- Suppression de données RGPD
- Expiration automatique après 30 jours
- Responsive design sur mobile

**Tests de sécurité :**

- Validation du chiffrement AES-256-GCM
- Tests d'injection XSS sur les données Guest
- Vérification de l'expiration automatique
- Tests de conformité RGPD
- Validation de l'intégrité des données migrées

**Configuration des tests :**

- Tests dans `src/__tests__/guest/`
- Mocks pour localStorage et crypto-js
- Données de test avec sessions et exercices réalistes
- Tests de performance pour le chiffrement
- Tests d'expiration avec manipulation du temps

### File Locations

- Pages Guest : `src/pages/guest/`
- Composants Guest : `src/components/features/guest/`
- Composants Export : `src/components/features/export/`
- Composants Privacy : `src/components/features/privacy/`
- Services : `src/services/guestService.ts`, `src/services/guestMigrationService.ts`
- Service chiffrement : `src/services/encryptionService.ts`
- Service RGPD : `src/services/gdprService.ts`
- Hooks : `src/hooks/useGuest.ts`, `src/hooks/useGuestMigration.ts`, `src/hooks/useLocalStorage.ts`
- Utilitaires : `src/utils/encryption.ts`, `src/utils/localStorage.ts`
- Types : `src/types/guest.ts`, `src/types/gdpr.ts`
- Tests : `src/__tests__/guest/`, `src/__tests__/integration/guest-migration.test.tsx`

### Technical Constraints

- React 19 avec TypeScript strict
- LocalStorage pour le stockage Guest (limite ~5-10MB)
- crypto-js pour le chiffrement client-side (AES-256-GCM)
- Expiration automatique après 30 jours
- Conformité RGPD stricte (consentement explicite, droit à l'oubli)
- Migration sécurisée vers Supabase avec validation
- Support du mode hors ligne limité (localStorage uniquement)
- Interface responsive mobile-first
- Aucune dépendance serveur pour le mode Guest (fonctionne complètement offline)
- Limite de 100 sessions maximum en mode Guest pour éviter la saturation localStorage
- Bannière de conversion non intrusive mais visible
- Export limité aux formats CSV/PDF légers

**Sécurité et RGPD :**

- Chiffrement client-side obligatoire pour toutes les données Guest
- Consentement explicite avant migration
- Suppression automatique après expiration ou migration
- Mentions légales dans tous les exports
- Logs de consentement pour traçabilité
- Aucune transmission de données sans consentement
- Principe de minimisation des données

## Change Log

| Date       | Version | Description                   | Author   |
| ---------- | ------- | ----------------------------- | -------- |
| 2025-01-15 | 1.0     | Création initiale de la story | John (PM) |

## Dev Agent Record

### Agent Model Used

_À compléter par l'agent de développement (ex: Claude Sonnet 4.5)_

### Debug Log References

_À compléter lors du développement_

### Completion Notes List

_À compléter lors du développement_

### File List

_À compléter lors du développement_

**New Files Created:**
- `src/services/guestService.ts`
- `src/services/guestMigrationService.ts`
- `src/services/encryptionService.ts`
- `src/services/gdprService.ts`
- `src/components/features/guest/GuestOnboarding.tsx`
- `src/components/features/guest/GuestBanner.tsx`
- `src/components/features/guest/GuestMigrationModal.tsx`
- `src/components/features/export/ExportSettings.tsx`
- `src/components/features/export/DataDeletionModal.tsx`
- `src/hooks/useGuest.ts`
- `src/hooks/useGuestMigration.ts`
- `src/hooks/useLocalStorage.ts`
- `src/pages/guest/GuestHomePage.tsx`
- `src/types/guest.ts`
- `src/types/gdpr.ts`
- `src/utils/encryption.ts`
- `src/utils/localStorage.ts`
- `src/__tests__/guest/*.test.ts`
- `src/__tests__/integration/guest-migration.test.tsx`

**Modified Files:**
- `src/services/sportExportService.ts` - Extension pour mode Guest
- `src/App.tsx` - Routing Guest
- `src/components/layouts/AppLayout.tsx` - Support mode Guest

**Test Files:**
- `src/__tests__/guest/guestService.test.ts`
- `src/__tests__/guest/encryptionService.test.ts`
- `src/__tests__/guest/guestMigrationService.test.ts`
- `src/__tests__/guest/gdprService.test.ts`
- `src/__tests__/integration/guest-migration.test.tsx`
- `e2e/guest-onboarding.spec.ts`
- `e2e/guest-conversion.spec.ts`

## QA Results

### Review Date: _À compléter par QA_

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

_À compléter lors de la revue QA_

### Refactoring Performed

_À compléter lors de la revue QA_

### Compliance Check

- **Coding Standards**: _À vérifier_
- **Project Structure**: _À vérifier_
- **Testing Strategy**: _À vérifier_
- **All ACs Met**: _À vérifier_
- **RGPD Compliance**: _À vérifier - Critique pour cette story_

### Improvements Checklist

- [ ] Implémenter le service de gestion Guest avec localStorage chiffré
- [ ] Créer le service de chiffrement client-side avec crypto-js
- [ ] Développer le service de migration Guest vers compte Supabase
- [ ] Implémenter le service RGPD avec consentement et suppression
- [ ] Créer les composants d'onboarding et bannière de conversion
- [ ] Développer le modal de migration avec progression
- [ ] Étendre le service d'export pour le mode Guest
- [ ] Créer les hooks useGuest, useGuestMigration, useLocalStorage
- [ ] Ajouter les tests unitaires pour tous les services
- [ ] Ajouter les tests d'intégration pour la migration
- [ ] Ajouter les tests E2E pour le parcours Guest complet
- [ ] Ajouter les tests de sécurité pour le chiffrement
- [ ] Implémenter la gestion de l'expiration automatique
- [ ] Créer la documentation RGPD (mentions légales, politique de confidentialité)
- [ ] Valider la conformité RGPD complète

### Security Review

**CRITIQUE** - Cette story nécessite une attention particulière sur :
- Chiffrement client-side robuste (AES-256-GCM)
- Validation stricte du consentement RGPD
- Suppression complète et vérifiable des données
- Protection contre les injections XSS sur données Guest
- Validation de l'intégrité des données lors de la migration
- Expiration automatique fiable après 30 jours
- Aucune fuite de données Guest vers le serveur sans consentement

### Performance Considerations

**ATTENTION** - Points critiques de performance :
- Limite de taille localStorage (~5-10MB selon navigateur)
- Performance du chiffrement/déchiffrement (optimiser pour mobile)
- Limite de 100 sessions maximum en mode Guest
- Migration asynchrone avec indicateur de progression
- Nettoyage régulier des données expirées
- Export optimisé pour éviter le blocage de l'UI

### Files Modified During Review

_À compléter lors de la revue QA_

### Gate Status

Gate: _À créer_ → `docs/qa/gates/1.7-mode-guest-et-export.yml`
Risk profile: _À créer_ → `docs/qa/assessments/1.7-risk-YYYYMMDD.md`
NFR assessment: _À créer_ → `docs/qa/assessments/1.7-nfr-YYYYMMDD.md`
Test design: _À créer_ → `docs/qa/assessments/1.7-test-design-YYYYMMDD.md`

### Recommended Status

_À compléter après revue QA complète_

## Security and RGPD Concerns

### Security Considerations

1. **Chiffrement Client-Side**
   - Utiliser crypto-js avec AES-256-GCM
   - Générer des clés de chiffrement robustes (cryptographically secure random)
   - Stocker les clés de manière sécurisée dans localStorage
   - Valider l'intégrité des données chiffrées avant déchiffrement
   - Implémenter la rotation des clés si nécessaire

2. **Protection des Données**
   - Aucune transmission de données Guest sans consentement explicite
   - Chiffrement obligatoire pour toutes les données sensibles
   - Validation stricte des données avant stockage
   - Protection contre les injections XSS/CSRF
   - Nettoyage automatique des données expirées

3. **Migration Sécurisée**
   - Validation de l'intégrité des données avant migration
   - Transmission HTTPS obligatoire vers Supabase
   - Rollback automatique en cas d'erreur
   - Vérification post-migration de la cohérence des données
   - Nettoyage complet du localStorage après migration réussie

### RGPD Compliance

1. **Consentement Explicite**
   - Formulaire de consentement clair avant migration
   - Acceptation explicite des CGU et politique de confidentialité
   - Enregistrement horodaté du consentement
   - Possibilité de retirer le consentement
   - Information claire sur l'utilisation des données

2. **Droit à l'Oubli**
   - Suppression complète et vérifiable des données
   - Nettoyage de toutes les traces (localStorage, sessions, etc.)
   - Confirmation de suppression à l'utilisateur
   - Logs de suppression pour traçabilité
   - Expiration automatique après 30 jours

3. **Minimisation des Données**
   - Collecte uniquement des données strictement nécessaires
   - Aucune donnée personnelle superflue en mode Guest
   - Export limité aux données essentielles
   - Anonymisation des données si possible
   - Limitation de la durée de rétention (30 jours max)

4. **Transparence**
   - Mentions légales claires dans tous les exports
   - Information sur la durée de rétention (30 jours)
   - Politique de confidentialité accessible
   - Information sur les droits RGPD (accès, rectification, suppression)
   - Bannière d'information claire sur le traitement des données

5. **Sécurité des Données**
   - Chiffrement obligatoire pour toutes les données Guest
   - Protection contre les accès non autorisés
   - Audit régulier de la sécurité
   - Documentation des mesures de sécurité
   - Formation des développeurs aux bonnes pratiques RGPD

### Recommandations

1. **Avant le Développement**
   - Revue de la stratégie de chiffrement par un expert sécurité
   - Validation juridique de la conformité RGPD
   - Préparation de la documentation RGPD complète
   - Définition des KPIs de sécurité et conformité

2. **Pendant le Développement**
   - Tests de sécurité continus (chiffrement, injection, etc.)
   - Revue de code focalisée sur la sécurité et le RGPD
   - Tests de conformité RGPD à chaque étape
   - Documentation technique détaillée

3. **Avant la Mise en Production**
   - Audit de sécurité complet par un tiers
   - Validation RGPD par un Data Protection Officer (DPO)
   - Tests de charge sur le chiffrement/déchiffrement
   - Procédure de gestion des incidents de sécurité
   - Plan de communication sur la protection des données

4. **Post-Déploiement**
   - Monitoring de l'expiration automatique
   - Vérification régulière du nettoyage des données
   - Audit des logs de consentement
   - Veille sur les évolutions réglementaires RGPD
   - Formation continue des utilisateurs sur leurs droits
