# Story 1.6: Gamification et Rappels

## Status

Ready for Development

## Story

**En tant qu'** utilisateur sportif,
**Je veux** être motivé par la gamification et recevoir des rappels,
**Afin de** maintenir ma régularité d'entraînement.

## Acceptance Criteria

1. Système de streaks (jours consécutifs) avec calcul automatique et persistance
2. Badges de progression (paliers) avec attribution automatique et galerie de visualisation
3. Système de rappels (notifications locales/email) avec configuration utilisateur (opt-in)
4. Interface de visualisation des récompenses avec animations et feedback

## Tasks / Subtasks

- [ ] Créer la migration de base de données pour la gamification (AC: 1, 2, 3)
  - [ ] Créer la table `user_streaks` avec current_streak, best_streak, last_activity_date
  - [ ] Créer la table `badges` avec les définitions de badges (paliers)
  - [ ] Créer la table `user_badges` pour les badges gagnés par utilisateur
  - [ ] Créer la table `notification_preferences` pour les préférences utilisateur
  - [ ] Ajouter les index pour les performances (user_id, badge_id, earned_at)
  - [ ] Créer les fonctions PostgreSQL pour le calcul automatique des streaks
  - [ ] Créer les triggers pour l'attribution automatique des badges
  - [ ] Activer les politiques RLS pour toutes les tables
- [ ] Implémenter le système de streaks (AC: 1)
  - [ ] Créer le service `streakService.ts` avec calcul de streak
  - [ ] Implémenter la fonction de mise à jour automatique du streak
  - [ ] Implémenter la détection de rupture de streak
  - [ ] Créer le hook `useStreak.ts` pour l'accès au streak
  - [ ] Intégrer le calcul du streak avec la validation de séance
  - [ ] Gérer le changement de fuseau horaire
  - [ ] Ajouter la persistance du streak en base de données
  - [ ] Implémenter le cache local pour les performances
- [ ] Développer le système de badges (AC: 2)
  - [ ] Créer le service `badgeService.ts` avec logique d'attribution
  - [ ] Définir les badges de paliers (5, 10, 25, 50, 100 séances)
  - [ ] Définir les badges de streaks (7, 14, 30 jours)
  - [ ] Définir les badges de durée (10h, 25h, 50h total)
  - [ ] Implémenter la logique de vérification des badges
  - [ ] Créer le hook `useBadges.ts` pour l'accès aux badges
  - [ ] Implémenter la notification de nouveau badge gagné
  - [ ] Ajouter les animations de célébration
- [ ] Améliorer les composants de visualisation existants (AC: 4)
  - [ ] Améliorer `StreakCounter.tsx` avec animations et détails
  - [ ] Améliorer `BadgeSystem.tsx` avec progression et célébrations
  - [ ] Créer `BadgeGallery.tsx` pour la galerie complète des badges
  - [ ] Créer `BadgeProgress.tsx` pour la progression vers le prochain badge
  - [ ] Créer `StreakCalendar.tsx` pour la vue calendrier du streak
  - [ ] Créer `GamificationDashboard.tsx` pour le dashboard de gamification
  - [ ] Intégrer les animations de célébration (confetti, badges qui scintillent)
  - [ ] Ajouter les sons de récompense (optionnels, opt-in)
- [ ] Implémenter le système de notifications (AC: 3)
  - [ ] Créer le service `notificationService.ts` pour les notifications
  - [ ] Implémenter les notifications push locales (Web Notifications API)
  - [ ] Implémenter les notifications par email (via Supabase Edge Functions)
  - [ ] Créer le composant `NotificationSettings.tsx` pour la configuration
  - [ ] Créer le composant `ReminderModal.tsx` pour la première configuration
  - [ ] Implémenter le hook `useNotifications.ts` pour la gestion d'état
  - [ ] Gérer les permissions de notifications (demande opt-in)
  - [ ] Implémenter le scheduling des rappels
  - [ ] Ajouter la logique d'envoi différé (temps optimal)
  - [ ] Gérer les time zones pour les rappels
  - [ ] Implémenter la désactivation/réactivation des rappels
  - [ ] Ajouter les templates de rappels motivants
- [ ] Créer l'Edge Function pour les notifications email (AC: 3)
  - [ ] Créer `send-reminder-email` Edge Function
  - [ ] Implémenter le template d'email de rappel
  - [ ] Ajouter la logique de scheduling (cron job)
  - [ ] Gérer les préférences utilisateur (opt-out)
  - [ ] Ajouter le tracking des emails envoyés
  - [ ] Implémenter la limitation de fréquence (rate limiting)
- [ ] Intégrer la gamification dans le parcours utilisateur (AC: 1, 2, 4)
  - [ ] Afficher le streak sur le dashboard principal
  - [ ] Afficher les badges récemment gagnés sur le dashboard
  - [ ] Ajouter une notification toast lors de l'obtention d'un badge
  - [ ] Créer une page dédiée `/gamification` avec tous les détails
  - [ ] Ajouter un lien vers la gamification dans la navigation
  - [ ] Intégrer les récompenses dans le flux de validation de séance
  - [ ] Ajouter les badges au profil utilisateur
- [ ] Créer les tests unitaires (AC: 1, 2, 3, 4)
  - [ ] Tests pour le calcul de streak (journalier, consécutif, rupture)
  - [ ] Tests pour l'attribution automatique des badges
  - [ ] Tests pour les préférences de notifications
  - [ ] Tests pour le service de notifications (mock)
  - [ ] Tests pour les hooks (useStreak, useBadges, useNotifications)
  - [ ] Tests pour les composants de visualisation
  - [ ] Tests pour la détection des paliers
  - [ ] Tests de performance pour les calculs
- [ ] Créer les tests d'intégration (AC: 1, 2, 3, 4)
  - [ ] Tests de bout-en-bout pour le calcul du streak
  - [ ] Tests de bout-en-bout pour l'attribution des badges
  - [ ] Tests d'intégration avec Supabase
  - [ ] Tests des notifications push (permissions)
  - [ ] Tests des Edge Functions de notification
  - [ ] Tests du flux complet de gamification
  - [ ] Tests de la persistance des données
  - [ ] Tests de la synchronisation multi-devices
- [ ] Créer les tests E2E (AC: 1, 2, 3, 4)
  - [ ] Test du parcours complet de gamification
  - [ ] Test de l'obtention d'un premier badge
  - [ ] Test de la configuration des rappels
  - [ ] Test de la rupture et reprise du streak
  - [ ] Test de la galerie de badges
  - [ ] Test des animations de célébration
  - [ ] Test responsive sur mobile
  - [ ] Test des notifications push

## Dev Notes

### Architecture Context

[Source: docs/architecture/03-data-models.md#gamification, docs/prd-v1.2-sport-mvp.md#FR8-FR9]

**Stack Frontend:**

- React 19 + TypeScript + Vite
- TanStack Query v5 pour la gestion d'état serveur
- Radix UI + Tailwind CSS pour l'interface
- Zustand pour l'état global de gamification
- React Hook Form + Zod pour les formulaires de configuration
- Web Notifications API pour les notifications locales
- Framer Motion pour les animations de célébration

**Modèles de données:**

```typescript
// UserStreak - Suivi des streaks utilisateur
interface UserStreak {
  user_id: string;
  current_streak: number;
  best_streak: number;
  last_activity_date: Date;
  streak_updated_at: Date;
}

// Badge - Définitions des badges disponibles
interface Badge {
  id: string;
  name: string;
  description: string;
  icon: string;
  requirement_type: 'sessions' | 'streak' | 'duration';
  requirement_value: number;
  tier: 'bronze' | 'silver' | 'gold' | 'platinum';
  created_at: Date;
}

// UserBadge - Badges gagnés par utilisateur
interface UserBadge {
  id: string;
  user_id: string;
  badge_id: string;
  earned_at: Date;
  progress: number;
  notified: boolean;
}

// NotificationPreference - Préférences de notifications
interface NotificationPreference {
  user_id: string;
  email_enabled: boolean;
  push_enabled: boolean;
  reminder_time: string; // HH:MM format (ex: "18:00")
  reminder_days: number[]; // 0-6 (Sunday-Saturday)
  reminder_frequency: 'daily' | 'twice_weekly' | 'weekly';
  last_reminded_at: Date;
  timezone: string;
  created_at: Date;
  updated_at: Date;
}

// StreakHistory - Historique des streaks (optionnel pour analytics)
interface StreakHistory {
  id: string;
  user_id: string;
  streak_length: number;
  start_date: Date;
  end_date: Date;
  created_at: Date;
}
```

**Structure de composants:**

```
src/components/features/sport/
├── Gamification/
│   ├── GamificationDashboard.tsx      # Dashboard principal
│   ├── StreakCounter.tsx              # Composant de streak (amélioré)
│   ├── StreakCalendar.tsx             # Calendrier visuel du streak
│   ├── BadgeSystem.tsx                # Système de badges (amélioré)
│   ├── BadgeGallery.tsx               # Galerie de tous les badges
│   ├── BadgeProgress.tsx              # Progression vers badges
│   ├── BadgeEarnedModal.tsx           # Modal de célébration nouveau badge
│   ├── NotificationSettings.tsx       # Configuration des notifications
│   ├── ReminderModal.tsx              # Modal de configuration initiale
│   └── CelebrationAnimation.tsx       # Animations de célébration
```

**Hooks spécialisés:**

```typescript
// Hook pour la gestion des streaks
function useStreak() {
  return {
    currentStreak: number;
    bestStreak: number;
    lastActivityDate: Date;
    isStreakActive: boolean;
    updateStreak: (date: Date) => Promise<void>;
    isLoading: boolean;
    error: Error | null;
  };
}

// Hook pour la gestion des badges
function useBadges() {
  return {
    earnedBadges: Badge[];
    availableBadges: Badge[];
    nextBadgeProgress: BadgeProgress;
    checkAndAwardBadges: () => Promise<Badge[]>;
    isLoading: boolean;
    error: Error | null;
  };
}

// Hook pour la gestion des notifications
function useNotifications() {
  return {
    preferences: NotificationPreference;
    updatePreferences: (prefs: Partial<NotificationPreference>) => Promise<void>;
    requestPermission: () => Promise<boolean>;
    scheduleReminder: (time: string) => Promise<void>;
    cancelReminders: () => Promise<void>;
    hasPermission: boolean;
    isLoading: boolean;
    error: Error | null;
  };
}
```

**Services:**

```typescript
// streakService.ts - Gestion des streaks
export const streakService = {
  // Calculer le streak actuel
  calculateCurrentStreak: async (userId: string): Promise<StreakData> => {
    // Logique de calcul basée sur les séances complétées
  },

  // Mettre à jour le streak après une séance
  updateStreakAfterSession: async (userId: string, sessionDate: Date): Promise<StreakData> => {
    // Mise à jour automatique du streak
  },

  // Vérifier si le streak est maintenu
  checkStreakStatus: async (userId: string): Promise<boolean> => {
    // Vérification journalière
  },

  // Récupérer l'historique du streak
  getStreakHistory: async (userId: string): Promise<StreakHistory[]> => {
    // Historique complet
  }
};

// badgeService.ts - Gestion des badges
export const badgeService = {
  // Définir les badges disponibles
  getBadgeDefinitions: (): Badge[] => {
    // Liste complète des badges
  },

  // Vérifier et attribuer les nouveaux badges
  checkAndAwardBadges: async (userId: string): Promise<Badge[]> => {
    // Vérification après validation de séance
  },

  // Calculer la progression vers le prochain badge
  calculateBadgeProgress: async (userId: string): Promise<BadgeProgress> => {
    // Progression vers paliers
  },

  // Récupérer les badges gagnés
  getEarnedBadges: async (userId: string): Promise<UserBadge[]> => {
    // Liste des badges gagnés
  }
};

// notificationService.ts - Gestion des notifications
export const notificationService = {
  // Demander la permission pour les notifications
  requestPermission: async (): Promise<boolean> => {
    // Permission Web Notifications API
  },

  // Envoyer une notification locale
  sendLocalNotification: (title: string, body: string): void => {
    // Notification push locale
  },

  // Programmer un rappel
  scheduleReminder: async (userId: string, preferences: NotificationPreference): Promise<void> => {
    // Scheduling via Edge Function
  },

  // Annuler les rappels
  cancelReminders: async (userId: string): Promise<void> => {
    // Annulation des rappels
  },

  // Envoyer un email de rappel
  sendReminderEmail: async (userId: string, email: string): Promise<void> => {
    // Via Edge Function Supabase
  },

  // Générer un template de rappel motivant
  generateReminderTemplate: (userName: string, streak: number): string => {
    // Templates personnalisés
  }
};
```

**Requêtes Supabase optimisées:**

```typescript
// Récupération du streak utilisateur
const getUserStreak = async (userId: string) => {
  const { data: streak } = await supabase
    .from('user_streaks')
    .select('*')
    .eq('user_id', userId)
    .single();

  return streak;
};

// Mise à jour du streak
const updateStreak = async (userId: string, streakData: Partial<UserStreak>) => {
  const { data } = await supabase
    .from('user_streaks')
    .upsert({
      user_id: userId,
      ...streakData,
      streak_updated_at: new Date().toISOString(),
    })
    .select()
    .single();

  return data;
};

// Récupération des badges gagnés avec détails
const getEarnedBadges = async (userId: string) => {
  const { data: userBadges } = await supabase
    .from('user_badges')
    .select(
      `
      *,
      badge:badges (
        id, name, description, icon, requirement_type,
        requirement_value, tier
      )
    `
    )
    .eq('user_id', userId)
    .order('earned_at', { ascending: false });

  return userBadges;
};

// Attribution d'un nouveau badge
const awardBadge = async (userId: string, badgeId: string) => {
  const { data } = await supabase
    .from('user_badges')
    .insert({
      user_id: userId,
      badge_id: badgeId,
      earned_at: new Date().toISOString(),
      notified: false,
    })
    .select(
      `
      *,
      badge:badges (*)
    `
    )
    .single();

  return data;
};

// Récupération des préférences de notifications
const getNotificationPreferences = async (userId: string) => {
  const { data: prefs } = await supabase
    .from('notification_preferences')
    .select('*')
    .eq('user_id', userId)
    .single();

  return prefs;
};

// Mise à jour des préférences de notifications
const updateNotificationPreferences = async (
  userId: string,
  preferences: Partial<NotificationPreference>
) => {
  const { data } = await supabase
    .from('notification_preferences')
    .upsert({
      user_id: userId,
      ...preferences,
      updated_at: new Date().toISOString(),
    })
    .select()
    .single();

  return data;
};
```

**Définitions des badges:**

```typescript
// Badges de sessions (paliers)
const SESSION_BADGES = [
  {
    id: 'badge_sessions_5',
    name: 'Débutant',
    description: 'Complétez 5 séances',
    icon: '🥉',
    requirement_type: 'sessions',
    requirement_value: 5,
    tier: 'bronze',
  },
  {
    id: 'badge_sessions_10',
    name: 'Motivé',
    description: 'Complétez 10 séances',
    icon: '🥈',
    requirement_type: 'sessions',
    requirement_value: 10,
    tier: 'silver',
  },
  {
    id: 'badge_sessions_25',
    name: 'Assidu',
    description: 'Complétez 25 séances',
    icon: '🥇',
    requirement_type: 'sessions',
    requirement_value: 25,
    tier: 'gold',
  },
  {
    id: 'badge_sessions_50',
    name: 'Champion',
    description: 'Complétez 50 séances',
    icon: '🏆',
    requirement_type: 'sessions',
    requirement_value: 50,
    tier: 'platinum',
  },
  {
    id: 'badge_sessions_100',
    name: 'Légende',
    description: 'Complétez 100 séances',
    icon: '👑',
    requirement_type: 'sessions',
    requirement_value: 100,
    tier: 'platinum',
  },
];

// Badges de streaks
const STREAK_BADGES = [
  {
    id: 'badge_streak_7',
    name: 'Une Semaine',
    description: '7 jours consécutifs',
    icon: '🔥',
    requirement_type: 'streak',
    requirement_value: 7,
    tier: 'bronze',
  },
  {
    id: 'badge_streak_14',
    name: 'Deux Semaines',
    description: '14 jours consécutifs',
    icon: '💪',
    requirement_type: 'streak',
    requirement_value: 14,
    tier: 'silver',
  },
  {
    id: 'badge_streak_30',
    name: 'Un Mois',
    description: '30 jours consécutifs',
    icon: '⚡',
    requirement_type: 'streak',
    requirement_value: 30,
    tier: 'gold',
  },
];

// Badges de durée
const DURATION_BADGES = [
  {
    id: 'badge_duration_600',
    name: '10 Heures',
    description: '10h d\'entraînement total',
    icon: '⏱️',
    requirement_type: 'duration',
    requirement_value: 600, // minutes
    tier: 'bronze',
  },
  {
    id: 'badge_duration_1500',
    name: '25 Heures',
    description: '25h d\'entraînement total',
    icon: '🎯',
    requirement_type: 'duration',
    requirement_value: 1500,
    tier: 'silver',
  },
  {
    id: 'badge_duration_3000',
    name: '50 Heures',
    description: '50h d\'entraînement total',
    icon: '💎',
    requirement_type: 'duration',
    requirement_value: 3000,
    tier: 'gold',
  },
];
```

**Animations et feedback:**

```typescript
// Configuration des animations de célébration
const celebrationConfig = {
  confetti: {
    duration: 3000,
    particleCount: 100,
    spread: 70,
    origin: { y: 0.6 },
  },
  badgeAnimation: {
    scale: [1, 1.2, 1],
    rotate: [0, 10, -10, 0],
    duration: 600,
  },
  streakAnimation: {
    flame: {
      scale: [1, 1.3, 1],
      opacity: [1, 0.8, 1],
      duration: 1000,
      repeat: Infinity,
    },
  },
};

// Notification toast lors de l'obtention d'un badge
const showBadgeEarnedToast = (badge: Badge) => {
  toast.success(
    <div className="flex items-center space-x-3">
      <span className="text-3xl">{badge.icon}</span>
      <div>
        <p className="font-semibold">Nouveau badge!</p>
        <p className="text-sm">{badge.name}</p>
      </div>
    </div>,
    {
      duration: 5000,
      position: 'top-center',
    }
  );
};
```

**Edge Function pour les notifications email:**

```typescript
// supabase/functions/send-reminder-email/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

serve(async (req) => {
  const { userId, email, userName, currentStreak } = await req.json();

  // Vérifier les préférences utilisateur
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL') ?? '',
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
  );

  const { data: prefs } = await supabase
    .from('notification_preferences')
    .select('*')
    .eq('user_id', userId)
    .single();

  if (!prefs?.email_enabled) {
    return new Response(JSON.stringify({ skipped: true }), { status: 200 });
  }

  // Générer le template d'email personnalisé
  const emailTemplate = generateReminderEmail(userName, currentStreak);

  // Envoyer l'email via service de votre choix
  // (Resend, SendGrid, etc.)

  // Logger l'envoi
  await supabase.from('notification_logs').insert({
    user_id: userId,
    type: 'email_reminder',
    sent_at: new Date().toISOString(),
  });

  return new Response(JSON.stringify({ success: true }), { status: 200 });
});

function generateReminderEmail(userName: string, currentStreak: number): string {
  const templates = [
    `Salut ${userName}! Ton streak de ${currentStreak} jours t'attend. Prêt pour une nouvelle séance?`,
    `${userName}, maintiens ton élan! ${currentStreak} jours de suite, c'est impressionnant!`,
    `Hey ${userName}! Une petite séance aujourd'hui pour continuer ton streak de ${currentStreak} jours?`,
  ];

  return templates[Math.floor(Math.random() * templates.length)];
}
```

### Testing Standards

[Source: docs/architecture/04-component-architecture.md#testing-requirements]

**Tests unitaires (Vitest):**

- Calcul du streak (consécutif, rupture, reprise)
- Logique d'attribution des badges (paliers)
- Validation des préférences de notifications
- Génération des templates de rappels
- Vérification des permissions
- Calculs de progression vers badges
- Services (streakService, badgeService, notificationService)
- Hooks personnalisés (useStreak, useBadges, useNotifications)

**Tests d'intégration:**

- Attribution automatique des badges après validation de séance
- Mise à jour du streak en temps réel
- Persistance des préférences de notifications
- Synchronisation des données entre devices
- Intégration avec les Edge Functions
- Tests des requêtes Supabase avec RLS
- Tests du cache local

**Tests E2E (Playwright):**

- Flux complet de gamification (validation séance → badge gagné)
- Configuration des rappels avec permissions
- Visualisation de la galerie de badges
- Rupture et reprise d'un streak
- Animations de célébration
- Tests responsive sur mobile
- Tests des notifications push
- Tests du calendrier de streak

**Configuration des tests:**

- Tests dans `src/__tests__/gamification/`
- Mocks pour les Web Notifications API
- Mocks pour les Edge Functions
- Données de test réalistes (streaks, badges)
- Tests de performance pour le calcul de streak
- Tests de charge pour les notifications

### File Locations

**Database:**
- Migration: `supabase/migrations/006_gamification_tables.sql`
- Edge Function: `supabase/functions/send-reminder-email/index.ts`
- Cron configuration: `supabase/functions/send-reminder-email/cron.yml`

**Pages:**
- Page gamification: `src/pages/sport/GamificationPage.tsx`

**Components:**
- Gamification: `src/components/features/sport/Gamification/`
- StreakCounter: `src/components/features/sport/StreakCounter.tsx` (amélioration)
- BadgeSystem: `src/components/features/sport/BadgeSystem.tsx` (amélioration)
- BadgeGallery: `src/components/features/sport/Gamification/BadgeGallery.tsx` (nouveau)
- NotificationSettings: `src/components/features/sport/Gamification/NotificationSettings.tsx` (nouveau)
- ReminderModal: `src/components/features/sport/Gamification/ReminderModal.tsx` (nouveau)

**Hooks:**
- useStreak: `src/hooks/useStreak.ts`
- useBadges: `src/hooks/useBadges.ts`
- useNotifications: `src/hooks/useNotifications.ts`

**Services:**
- streakService: `src/services/streakService.ts`
- badgeService: `src/services/badgeService.ts`
- notificationService: `src/services/notificationService.ts`

**Utils:**
- Badge definitions: `src/utils/badgeDefinitions.ts`
- Notification templates: `src/utils/notificationTemplates.ts`

**Types:**
- Types gamification: `src/types/gamification.ts`

**Tests:**
- Unit tests: `src/__tests__/unit/gamification/`
- Integration tests: `src/__tests__/integration/gamification/`
- E2E tests: `src/__tests__/e2e/gamification.spec.ts`

### Technical Constraints

- React 19 avec TypeScript strict
- TanStack Query pour la gestion d'état serveur
- Web Notifications API pour les notifications locales (support Chrome, Firefox, Edge)
- Permissions utilisateur obligatoires pour les notifications push
- Supabase Edge Functions pour les emails (Deno runtime)
- Conformité RGPD: opt-in explicite pour les rappels
- Rate limiting pour les emails (max 1 par jour par utilisateur)
- Animations performantes (Framer Motion avec GPU acceleration)
- Support des time zones (intl API)
- Cache local pour les performances (localStorage + TanStack Query)
- Calculs de streak côté serveur (PostgreSQL functions)
- RLS Supabase pour la sécurité des données
- Tests de permissions navigateurs multiples
- Interface responsive mobile-first
- Accessibilité WCAG AA pour les notifications
- Fallback si notifications non supportées

### Integration Points

**Avec Story 1.4 (Validation de séance):**
- Mise à jour automatique du streak après validation
- Attribution automatique des badges après validation
- Déclenchement des animations de célébration
- Mise à jour du cache local

**Avec Story 1.5 (Historique et statistiques):**
- Affichage du streak sur le dashboard
- Affichage des badges récemment gagnés
- Calcul des paliers pour les badges
- Intégration dans les statistiques globales

**Avec le profil utilisateur:**
- Configuration des préférences de notifications
- Affichage des badges dans le profil
- Historique des streaks
- Paramètres de time zone

**Avec la navigation:**
- Ajout de l'onglet ou section "Récompenses"
- Badge indicator sur l'icône de navigation
- Quick access au streak depuis le dashboard

## Change Log

| Date       | Version | Description                   | Author   |
| ---------- | ------- | ----------------------------- | -------- |
| 2025-01-15 | 1.0     | Création initiale de la story | John (PM) |

## Dev Agent Record

### Agent Model Used

_To be filled by development agent_

### Debug Log References

_To be filled during development_

### Completion Notes List

_To be filled during development_

### File List

_To be filled during development_

## QA Results

### Review Date

_To be filled by QA_

### Reviewed By

_To be filled by QA_

### Code Quality Assessment

_To be filled by QA_

### Refactoring Performed

_To be filled by QA_

### Compliance Check

- **Coding Standards**: _To be verified_
- **Project Structure**: _To be verified_
- **Testing Strategy**: _To be verified_
- **All ACs Met**: _To be verified_

### Improvements Checklist

- [ ] Créer la migration de base de données pour la gamification
- [ ] Implémenter le système de streaks avec calcul automatique
- [ ] Développer le système de badges avec attribution automatique
- [ ] Créer les composants de visualisation (galerie, progression)
- [ ] Implémenter le système de notifications (push + email)
- [ ] Créer l'Edge Function pour les emails de rappel
- [ ] Intégrer la gamification dans le parcours utilisateur
- [ ] Ajouter les animations de célébration
- [ ] Créer les tests unitaires pour tous les services
- [ ] Créer les tests d'intégration avec Supabase
- [ ] Créer les tests E2E pour le parcours gamification
- [ ] Vérifier la conformité RGPD (opt-in)
- [ ] Optimiser les performances des calculs
- [ ] Tester sur différents navigateurs et devices

### Security Review

_To be filled by QA_

### Performance Considerations

_To be filled by QA_

### Files Modified During Review

_To be filled by QA_

### Gate Status

_To be filled by QA_

### Recommended Status

_To be filled by QA_
